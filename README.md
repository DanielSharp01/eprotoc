# eprotoc

`eprotoc` is a compiler written for a modernized version of the protobuf descriptor language. `eprotoc` is designed to be used with typescript for code generation purposes.

## Differences from protobuf

- `eproto` uses packages like module system instead of importing files
- `eproto` supports generics
- `eproto` supports Date as a builtin type
- arrays are now represented with a generic type `Array<TypeArg>`
- oneOf is now a generic type `OneOf<TypeArg1, TypeArg2, ...>` and  does not support custom field numbers
- `eproto` enums can be string and integer enums as well

- `eproto` does not currently support more complex types such as Map, any, etc.
- `eproto` does not support reserved fields
- `eproto` does not support nested messages
- `eproto` does not support the notion of options

## "Evolved" eproto

The "e" in `eproto` is meant to be *evolved*. As such `eproto` is not meant to be an *extension* of protobuf. In fact it isn't even wire compatible by default.

Here are a list of incompatibilities with proto:
- Nullable is represented as a 1 or 1 + byteLength LEN tagged field
- There are top level types (tags with field number = 0)
- Currently even top level messages require a LEN tag (with field number = 0) *maybe will be fixed*
- Arrays can be optional which in normal proto is not
- Arrays can be nested which in normal proto is not
- Arrays cannot be sent in separate bits they are always packed into a single LEN

These incompatibilities mostly stem from the fact that I allow `eproto` to make use of field numberless LEN wire typed tags. In normal proto `2` as a tag is invalid as it does not have a field number

## "Native" eproto

**WIP**

Native in this context means compatible with protobuf. Encodings generated by the codegen would have an equivalent version that could be generated by protoc.

In the native case the protobuf can get generated as well.

Native still wouldn't be one to one compatbile from the parsing perspective. I just don't find value in non packed arrays.

## Development

- [x] Tokenizer
- [x] Parser
- [x] Analyzer
  - [x] Analyze value type of enums
  - [x] Analyze message ordinals
  - [x] Analyze message field types
  - [x] Analyze RPC input and output types
  - [x] Get definitions for codegen
  - [ ] Handle duplicate symbols
  - [ ] Handle duplicate symbols across packages (how should this affect codegen)
- [ ] VSCode extension
  - [ ] TextMate grammar for syntax higlighting
  - [ ] Language server integration
- [ ] Language Server
  - [x] Work done to be able to do per file compilation
  - [ ] Workspace support
  - [ ] Semantic token highlighting
  - [ ] Goto definition
  - [ ] Find references
  - [ ] Diagnostics
- [ ] Codegen (eproto => TypeScript / Nice GRPC)
  - [x] Generate encoder
  - [x] Generate decoder
  - [x] Generate NiceGRPC service definition
  - [ ] Non builtin generics support
  - [ ] One of support (union types)
  - [ ] Multi file importing
  - [ ] "Native" codegen
- [ ] Codegen (eproto => proto)